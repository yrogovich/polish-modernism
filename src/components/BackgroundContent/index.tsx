import React, {useEffect, useRef, useState} from 'react'
import { useStore } from '@nanostores/react';
import {isFooterInView, isPreloaderFinished, navHeight} from '@/store'
import {motion} from 'framer-motion'
import styles from './styles.module.scss';

const svgPolish = (
  <svg xmlns="http://www.w3.org/2000/svg" width="687" height="249" viewBox="0 0 687 249" fill="none">
    <path d="M0 3.45833V245.542H62.3761V174.3H63.0692C74.1582 174.3 83.8612 172.917 92.178 170.15C100.495 167.383 107.31 162.888 112.623 156.663C118.168 150.207 122.211 141.676 124.752 131.071C127.524 120.465 128.911 107.324 128.911 91.6458V90.9542C128.911 60.5208 123.251 38.3875 111.93 24.5542C100.61 10.4903 84.5543 3.45833 63.7622 3.45833H0ZM62.3761 57.4083H63.0692C64.9173 57.4083 65.9569 57.7542 66.188 58.4458C66.419 59.1375 66.5345 60.6361 66.5345 62.9417V114.817C66.5345 117.353 66.419 118.967 66.188 119.658C65.9569 120.119 64.9173 120.35 63.0692 120.35H62.3761V57.4083Z" fill="#FFF500"/>
    <path d="M131.642 63.9792V184.675C131.642 195.05 133.028 204.272 135.801 212.342C138.573 220.411 142.616 227.213 147.929 232.746C153.474 238.049 160.174 242.083 168.028 244.85C175.883 247.617 184.893 249 195.058 249C205.454 249 214.695 247.617 222.781 244.85C230.866 241.853 237.682 237.703 243.226 232.4C249.002 226.867 253.276 220.181 256.048 212.342C259.051 204.272 260.553 195.05 260.553 184.675V63.9792C260.553 53.8347 259.051 44.8431 256.048 37.0042C253.276 28.9347 249.002 22.2486 243.226 16.9458C237.682 11.4125 230.866 7.2625 222.781 4.49584C214.695 1.49861 205.454 0 195.058 0C184.893 0 175.883 1.38334 168.028 4.15001C160.174 6.91667 153.474 10.9514 147.929 16.2542C142.616 21.5569 138.573 28.2431 135.801 36.3125C133.028 44.3819 131.642 53.6042 131.642 63.9792ZM194.018 59.4833C194.018 58.3306 194.018 57.4083 194.018 56.7167C194.249 56.025 194.365 55.5639 194.365 55.3333C194.596 54.8722 194.827 54.5264 195.058 54.2958C195.52 54.0653 195.867 53.95 196.098 53.95C196.56 53.95 196.906 54.0653 197.137 54.2958C197.368 54.5264 197.484 54.8722 197.484 55.3333C197.715 55.5639 197.83 56.025 197.83 56.7167C198.061 57.4083 198.177 58.3306 198.177 59.4833V189.517C198.177 190.439 198.061 191.246 197.83 191.938C197.83 192.629 197.715 193.206 197.484 193.667C197.484 194.128 197.368 194.474 197.137 194.704C196.906 194.935 196.56 195.05 196.098 195.05C195.867 195.05 195.52 194.935 195.058 194.704C194.827 194.474 194.596 194.128 194.365 193.667C194.365 193.206 194.249 192.629 194.018 191.938C194.018 191.246 194.018 190.439 194.018 189.517V59.4833Z" fill="#FFF500"/>
    <path d="M264.638 3.45833V245.542H354.737V191.592H327.014V3.45833H264.638Z" fill="#FFF500"/>
    <path d="M357.701 3.45833V245.542H420.077V3.45833H357.701Z" fill="#FFF500"/>
    <path d="M553.279 86.4583V63.9792C553.279 43.4597 547.619 27.6667 536.299 16.6C524.979 5.53333 508.807 0 487.784 0C467.223 0 451.514 5.41805 440.656 16.2542C429.798 27.0903 424.369 42.9986 424.369 63.9792V67.0917C424.369 77.2361 424.831 85.9972 425.755 93.375C426.679 100.753 428.296 107.208 430.606 112.742C432.916 118.275 436.035 123.117 439.963 127.267C444.121 131.186 449.203 134.875 455.21 138.333L466.299 144.558C472.306 148.017 476.926 150.783 480.16 152.858C483.626 154.933 486.052 156.778 487.438 158.392C489.055 160.006 489.979 161.619 490.21 163.233C490.672 164.847 490.903 166.922 490.903 169.458V189.863C490.903 191.707 490.672 193.09 490.21 194.013C489.979 194.704 489.517 195.05 488.824 195.05C488.131 195.05 487.553 194.589 487.091 193.667C486.86 192.744 486.745 191.361 486.745 189.517V162.542H424.369V184.675C424.369 205.656 429.682 221.679 440.309 232.746C451.167 243.582 466.992 249 487.784 249C508.807 249 524.979 243.467 536.299 232.4C547.619 221.333 553.279 205.425 553.279 184.675V180.179C553.279 170.035 552.817 161.389 551.893 154.242C550.969 146.864 549.352 140.524 547.042 135.221C544.962 129.918 541.959 125.307 538.032 121.388C534.335 117.468 529.484 113.894 523.477 110.667L514.121 105.479C507.421 101.79 502.223 98.7931 498.527 96.4875C494.83 94.1819 492.058 92.2222 490.21 90.6083C488.593 88.7639 487.553 87.0347 487.091 85.4208C486.86 83.5764 486.745 81.3861 486.745 78.85V59.4833C486.745 57.6389 486.86 56.2556 487.091 55.3333C487.553 54.4111 488.131 53.95 488.824 53.95C489.517 53.95 489.979 54.4111 490.21 55.3333C490.672 56.2556 490.903 57.6389 490.903 59.4833V86.4583H553.279Z" fill="#FFF500"/>
    <path d="M623.899 3.45833V94.4125H619.741V3.45833H557.364V245.542H619.741V148.363H623.899V245.542H686.275V3.45833H623.899Z" fill="#FFF500"/>
  </svg>
)

const svgModernism = (
  <svg xmlns="http://www.w3.org/2000/svg" width="1162" height="249" viewBox="0 0 1162 249" fill="none">
    <path d="M0.136719 3.45833V245.542H57.3148L50.0376 114.125H54.196L62.5128 245.542H100.632L108.948 114.125H113.107L105.83 245.542H163.008V3.45833H83.9979V136.258H79.8395V3.45833H0.136719Z" fill="#FFF500"/>
    <path d="M167.312 63.9792V184.675C167.312 195.05 168.698 204.272 171.471 212.342C174.243 220.411 178.286 227.213 183.599 232.746C189.144 238.049 195.844 242.083 203.698 244.85C211.553 247.617 220.563 249 230.728 249C241.124 249 250.365 247.617 258.451 244.85C266.536 241.853 273.352 237.703 278.896 232.4C284.672 226.867 288.946 220.181 291.718 212.342C294.721 204.272 296.223 195.05 296.223 184.675V63.9792C296.223 53.8347 294.721 44.8431 291.718 37.0042C288.946 28.9347 284.672 22.2486 278.896 16.9458C273.352 11.4125 266.536 7.2625 258.451 4.49584C250.365 1.49861 241.124 0 230.728 0C220.563 0 211.553 1.38334 203.698 4.15001C195.844 6.91667 189.144 10.9514 183.599 16.2542C178.286 21.5569 174.243 28.2431 171.471 36.3125C168.698 44.3819 167.312 53.6042 167.312 63.9792ZM229.688 59.4833C229.688 58.3306 229.688 57.4083 229.688 56.7167C229.919 56.025 230.035 55.5639 230.035 55.3333C230.266 54.8722 230.497 54.5264 230.728 54.2958C231.19 54.0653 231.536 53.95 231.768 53.95C232.23 53.95 232.576 54.0653 232.807 54.2958C233.038 54.5264 233.154 54.8722 233.154 55.3333C233.385 55.5639 233.5 56.025 233.5 56.7167C233.731 57.4083 233.847 58.3306 233.847 59.4833V189.517C233.847 190.439 233.731 191.246 233.5 191.938C233.5 192.629 233.385 193.206 233.154 193.667C233.154 194.128 233.038 194.474 232.807 194.704C232.576 194.935 232.23 195.05 231.768 195.05C231.536 195.05 231.19 194.935 230.728 194.704C230.497 194.474 230.266 194.128 230.035 193.667C230.035 193.206 229.919 192.629 229.688 191.938C229.688 191.246 229.688 190.439 229.688 189.517V59.4833Z" fill="#FFF500"/>
    <path d="M300.308 3.45833V245.542H364.07C374.466 245.542 383.707 244.274 391.793 241.738C399.879 239.201 406.694 235.512 412.238 230.671C417.783 225.599 421.941 219.258 424.714 211.65C427.717 204.042 429.219 195.165 429.219 185.021V63.9792C429.219 53.8347 427.717 44.9583 424.714 37.35C421.941 29.7417 417.783 23.5167 412.238 18.675C406.694 13.6028 399.879 9.79862 391.793 7.26251C383.707 4.72639 374.466 3.45833 364.07 3.45833H300.308ZM363.031 57.4083H363.724C364.417 57.4083 364.994 57.5236 365.456 57.7542C365.919 57.7542 366.265 57.9847 366.496 58.4458C366.727 58.6764 366.843 59.2528 366.843 60.175C366.843 60.8667 366.843 61.7889 366.843 62.9417V186.058C366.843 187.211 366.843 188.249 366.843 189.171C366.843 189.863 366.727 190.439 366.496 190.9C366.265 191.131 365.919 191.361 365.456 191.592C364.994 191.592 364.417 191.592 363.724 191.592H363.031V57.4083Z" fill="#FFF500"/>
    <path d="M523.403 57.4083V3.45833H433.304V245.542H523.403V191.592H495.68V144.904H523.403V90.9542H495.68V57.4083H523.403Z" fill="#FFF500"/>
    <path d="M527.721 3.45833V245.542H590.097V159.083H590.79C592.638 159.083 593.678 159.429 593.909 160.121C594.14 160.582 594.255 162.081 594.255 164.617V195.742C594.255 205.194 594.371 213.956 594.602 222.025C595.064 230.094 596.104 237.933 597.721 245.542H660.097C658.48 237.933 657.44 230.21 656.978 222.371C656.747 214.301 656.632 205.656 656.632 196.433V193.667C656.632 184.444 655.476 176.144 653.166 168.767C650.856 161.389 647.968 155.164 644.503 150.092C641.037 145.019 637.225 141.1 633.067 138.333C628.909 135.567 624.981 134.183 621.285 134.183V130.033C624.981 130.033 628.909 128.881 633.067 126.575C637.225 124.039 641.037 120.235 644.503 115.163C647.968 110.09 650.856 103.865 653.166 96.4875C655.476 88.8792 656.632 80.0028 656.632 69.8583V68.1292C656.632 45.9958 650.971 29.7417 639.651 19.3667C628.331 8.76111 612.275 3.45833 591.483 3.45833H527.721ZM590.097 57.4083H590.79C592.638 57.4083 593.678 57.7542 593.909 58.4458C594.14 58.9069 594.255 60.2903 594.255 62.5958V99.6C594.255 102.136 594.14 103.75 593.909 104.442C593.678 104.903 592.638 105.133 590.79 105.133H590.097V57.4083Z" fill="#FFF500"/>
    <path d="M732.796 3.45833L748.39 136.258H744.924L727.598 3.45833H660.717V245.542H723.093L708.885 114.125H712.35L728.291 245.542H795.172V3.45833H732.796Z" fill="#FFF500"/>
    <path d="M799.466 3.45833V245.542H861.842V3.45833H799.466Z" fill="#FFF500"/>
    <path d="M995.043 86.4583V63.9792C995.043 43.4597 989.383 27.6667 978.063 16.6C966.743 5.53333 950.572 0 929.549 0C908.987 0 893.278 5.41805 882.42 16.2542C871.562 27.0903 866.133 42.9986 866.133 63.9792V67.0917C866.133 77.2361 866.595 85.9972 867.519 93.375C868.443 100.753 870.06 107.208 872.37 112.742C874.681 118.275 877.799 123.117 881.727 127.267C885.885 131.186 890.968 134.875 896.974 138.333L908.063 144.558C914.07 148.017 918.69 150.783 921.925 152.858C925.39 154.933 927.816 156.778 929.202 158.392C930.819 160.006 931.743 161.619 931.974 163.233C932.436 164.847 932.667 166.922 932.667 169.458V189.863C932.667 191.707 932.436 193.09 931.974 194.013C931.743 194.704 931.281 195.05 930.588 195.05C929.895 195.05 929.317 194.589 928.855 193.667C928.624 192.744 928.509 191.361 928.509 189.517V162.542H866.133V184.675C866.133 205.656 871.446 221.679 882.073 232.746C892.931 243.582 908.756 249 929.549 249C950.572 249 966.743 243.467 978.063 232.4C989.383 221.333 995.043 205.425 995.043 184.675V180.179C995.043 170.035 994.581 161.389 993.657 154.242C992.733 146.864 991.116 140.524 988.806 135.221C986.727 129.918 983.723 125.307 979.796 121.388C976.099 117.468 971.248 113.894 965.242 110.667L955.885 105.479C949.185 101.79 943.987 98.7931 940.291 96.4875C936.595 94.1819 933.822 92.2222 931.974 90.6083C930.357 88.7639 929.317 87.0347 928.855 85.4208C928.624 83.5764 928.509 81.3861 928.509 78.85V59.4833C928.509 57.6389 928.624 56.2556 928.855 55.3333C929.317 54.4111 929.895 53.95 930.588 53.95C931.281 53.95 931.743 54.4111 931.974 55.3333C932.436 56.2556 932.667 57.6389 932.667 59.4833V86.4583H995.043Z" fill="#FFF500"/>
    <path d="M999.129 3.45833V245.542H1056.31L1049.03 114.125H1053.19L1061.5 245.542H1099.62L1107.94 114.125H1112.1L1104.82 245.542H1162V3.45833H1082.99V136.258H1078.83V3.45833H999.129Z" fill="#FFF500"/>
  </svg>
)

const BackgroundContent = () => {
  const [titleRefTop, setTitleRefTop] = useState(0);
  const $isPreloaderFinished = useStore(isPreloaderFinished);
  const $isFooterInView = useStore(isFooterInView);
  const $navbarHeight = useStore(navHeight);
  const titleRef = useRef(null);

  useEffect(() => {
    const handleResize = () => {
      if (!titleRef?.current) return;
      setTitleRefTop(titleRef.current.getBoundingClientRect().top);
    };

    window.addEventListener('resize', handleResize);

    return () => window.removeEventListener('resize', handleResize);
  }, [$isPreloaderFinished]);

  useEffect(() => {
    if (!titleRef?.current) return;

    setTitleRefTop(titleRef.current.getBoundingClientRect().top)
  }, [titleRef, $isPreloaderFinished]);

  return $isPreloaderFinished ? (
    <motion.div
      className={styles.content}
    >
      {!$isFooterInView && <motion.div
        initial={{
          opacity: 0,
          y: 100,
        }}
        animate={{
          opacity: 1,
          y: 0,
          display: $isFooterInView ? 'none' : 'block',
        }}
        transition={{
          type: 'spring',
          stiffness: 30,
          damping: 10,
          duration: .6,
          delay: .8,
        }}
       className={styles.content__about}
      >Modernism - a current in architecture, also called functionalism. It developed in Poland in two phases, separated by World War II and the enforced period of socialist realism in architecture.</motion.div>}
      {!$isFooterInView && <motion.div className={styles.content__dates}>
        <motion.span
          initial={{
            opacity: 0,
            y: 200,
          }}
          animate={{
            opacity: 1,
            y: 0,
          }}
          transition={{
            type: 'spring',
            stiffness: 30,
            damping: 10,
            duration: .6,
            delay: .3,
          }}
        >1934</motion.span>
        <motion.span
          initial={{
            opacity: 0,
            y: 200,
          }}
          animate={{
            opacity: 1,
            y: 0,
          }}
          transition={{
            type: 'spring',
            stiffness: 30,
            damping: 10,
            duration: .6,
            delay: .35,
          }}
        >-</motion.span>
        <motion.span
          initial={{
            opacity: 0,
            y: 200,
          }}
          animate={{
            opacity: 1,
            y: 0,
          }}
          transition={{
            type: 'spring',
            stiffness: 30,
            damping: 10,
            duration: .6,
            delay: .4,
          }}
        >1993</motion.span>
      </motion.div>}

      <motion.div
        className={styles.content__title}
        ref={titleRef}
        animate={{
          y: $isFooterInView ? -(titleRefTop - $navbarHeight) : 0,
        }}
        transition={{
          type: 'spring',
          stiffness: 40,
          damping: 10,
          duration: 1,
        }}
      >
        <motion.span
          initial={{
            opacity: 0,
            y: 200,
          }}
          animate={{
            opacity: 1,
            y: 0,
          }}
          transition={{
            type: 'spring',
            stiffness: 30,
            damping: 10,
            duration: .6,
          }}
        >{svgPolish}</motion.span>
        <motion.span
          initial={{
            opacity: 0,
            y: 200,
          }}
          animate={{
            opacity: 1,
            y: 0,
          }}
          transition={{
            type: 'spring',
            stiffness: 30,
            damping: 10,
            duration: .6,
            delay: .15,
          }}
        >{svgModernism}</motion.span>
      </motion.div>
    </motion.div>
  ) : null
};

export default BackgroundContent;